'use strict';let drawer=new mdc.drawer.MDCTemporaryDrawer(document.querySelector('.mdc-temporary-drawer'));document.querySelectorAll('.menu').forEach(a=>a.addEventListener('click',()=>drawer.open=!0));const select1=new mdc.select.MDCSelect(document.querySelectorAll('.mdc-select')[0]),select2=new mdc.select.MDCSelect(document.querySelectorAll('.mdc-select')[1]),textfield1=new mdc.textfield.MDCTextfield(document.querySelectorAll('.mdc-textfield')[0]),textfield2=new mdc.textfield.MDCTextfield(document.querySelectorAll('.mdc-textfield')[1]),swap=document.querySelector('#changer'),list=document.querySelectorAll('.page__main, .page__settings, .page__about'),innerDrawerChld=Array.prototype.slice.call(document.querySelector('.mdc-temporary-drawer__content').children),snackbar=new mdc.snackbar.MDCSnackbar(document.querySelector('.mdc-snackbar')),pageLoading=document.querySelector('.page__loading'),pageMain=document.querySelector('.page__main');document.querySelectorAll('.mdc-temporary-drawer__content > .mdc-list-item').forEach(a=>a.addEventListener('click',openWindow));let val,snackbarOpt={actionText:'OK',actionHandler:function(){},timeout:1e17};select1.listen('MDCSelect:change',()=>{calc()}),select2.listen('MDCSelect:change',()=>{calc()});const spinner=document.querySelector('.spinner'),main=document.querySelector('.page__main');let data={},swalOptions={title:'Oops...',html:'Problem with your internet connection!<br>Sorry, our app need internet.',type:'error',showCloseButton:!0,showCancelButton:!0,allowOutsideClick:!1,confirmButtonText:'Retry',cancelButtonText:'Exit'},swalCallback=function(a){'cancel'===a?navigator.app.exitApp():'close'==a&&work()};swap.onclick=swapHandler,document.addEventListener('deviceready',work,!1);async function getValutesOnline(){try{data=await getAndParseJSON('http://api.fixer.io/latest'),configObj(data)}catch(a){showNetErr(a)}}function configObj(a){if(a.rates[a.base]=1,console.log(a),!a)throw new Error('Can`t get data')}async function getAndParseJSON(a){let b=await fetch(a),c=await b.json();return c}function getValutesOffline(){readFile()}function checkConnection(){return window.navigator.onLine}function showNetErr(a){console.error(a),swal(swalOptions).then(function(){work()},swalCallback)}function work(){try{checkConnection()?getValutesOnline():getValutesOffline(),enableMain()}catch(a){showNetErr(a)}pageLoading.classList.add('off'),setInterval(checker,10)}function enableMain(){pageMain.style.display='block'}function calc(){const[a,b,c]=countValCoefRes(textfield1);return''===c?void removeVal():void writeVal(b/a)}function countValCoefRes(a){const b=select1.selectedText_.textContent,c=select2.selectedText_.textContent,d=data.rates[b],f=data.rates[c],h=a.input_.value,i=parseFloat(h);return[d/f,i,h]}function writeVal(a){a=a?a:0,textfield2.label_.classList.add('mdc-textfield__label--float-above'),textfield2.input_.value=a}function removeVal(){textfield2.label_.classList.remove('mdc-textfield__label--float-above'),textfield2.input_.value=''}function showCacheErr(a){console.error(a)}function writeRequestFS(a){a.root.getFile('cache.json',{create:!0},writeFileEntry,errorCallback)}function writeFileEntry(a){a.createWriter(writeFileWriter,errorCallback)}function writeFileWriter(a){a.onwriteend=onwriteend,a.onerror=onwriteerror;let b=new Blob([JSON.stringify(data)],{type:'application/json'});a.write(b)}function onwriteend(){console.log('Write completed.')}function onwriteerror(a){throw new Error('Write failed: '+a.toString())}function writeFile(){let b=window.TEMPORARY;window.requestFileSystem(b,5242880,writeRequestFS,function(d){throw new Error('Write error: '+d.code)})}function readFile(){let b=window.TEMPORARY;window.requestFileSystem(b,5242880,successCallback,function(d){throw new Error('Read error: '+d.code)})}function readRequestFS(a){a.root.getFile('cache.json',{},readFileEntry,errorCallback)}function readFileEntry(a){a.file(function(b){let c=new FileReader;c.onloadend=function(){data=JSON.parse(this.result),snackbarOpt.message=`Using rates from ${data.date}`,snackbar.show(snackbarOpt)},c.readAsText(b)},errorCallback)}function swapHandler(){let a=select1.selectedText_.textContent,b=select2.selectedText_.textContent;select1.selectedText_.textContent=b,select2.selectedText_.textContent=a,calc()}function checker(){let a=textfield1.input_.value;a!=val&&data.rates&&calc(),val=a}function openWindow(){let a=this.dataset.window;list.forEach(b=>b.style.display='none'),document.querySelector(a).style.display='block',innerDrawerChld.forEach(b=>b.classList.remove('mdc-temporary-drawer--selected')),this.classList.add('mdc-temporary-drawer--selected'),drawer.open=!1}work();