'use strict';const input1=document.querySelector('#input1'),input2=document.querySelector('#input2'),input1Placeholder=document.querySelector('#input1-name'),input2Placeholder=document.querySelector('#input2-name'),selectFrom=document.querySelector('.select-from'),selectTo=document.querySelector('.select-to'),content=document.querySelector('.content'),spinner=document.querySelector('.spinner'),main=document.querySelector('.main'),submit=document.querySelector('.submit');let data={};new Choices('.select-from',{searchEnabled:!1}),new Choices('.select-to',{searchEnabled:!1}),changePlaceholder1(),selectFrom.onchange=changePlaceholder1,changePlaceholder2(),selectTo.onchange=changePlaceholder2,submit.onclick=clickHandler,document.addEventListener('deviceready',onDeviceReady,!1);function onDeviceReady(){work()}async function getValutesOnline(){try{let a=await fetch('https://www.cbr-xml-daily.ru/daily_json.js'),b=await a.json();if(b.Valute.RUB={Value:1,Nominal:1},console.log(b),data=b,!data)throw new Error('Can`t get data');writeFile()}catch(a){showNetErr(a)}}function getValutesOffline(){readFile()}function checkConnection(){return window.navigator.onLine}function showNetErr(a){console.error(a),swal({title:'Oops...',html:'Problem with your internet connection!<br>Sorry, our app need internet.',type:'error',showCloseButton:!0,showCancelButton:!0,allowOutsideClick:!1,confirmButtonText:'Retry',cancelButtonText:'Exit'}).then(function(){work()},function(b){'cancel'===b?navigator.app.exitApp():'close'==b&&work()})}function work(){spinner.classList.remove('off');try{checkConnection()?getValutesOnline():getValutesOffline(),main.classList.add('active'),content.classList.add('active')}catch(a){showNetErr(a)}spinner.classList.add('off')}function clickHandler(){const a=selectFrom.value,b=selectTo.value,c=data.Valute[a],d=data.Valute[b],f=c.Value/d.Value/c.Nominal/d.Nominal,g=parseFloat(input1.value);isNaN(g)||(input2.parentElement.classList.add('is-dirty'),input2.value=g*f)}function changePlaceholder1(){input1Placeholder.innerHTML=selectFrom.value}function changePlaceholder2(){input2Placeholder.innerHTML=selectTo.value}function showCacheErr(a){console.error(a)}function writeFile(){function b(f){throw new Error('Write error: '+f.code)}let c=window.TEMPORARY;window.requestFileSystem(c,5242880,function(f){f.root.getFile('cache.json',{create:!0},function(g){g.createWriter(function(h){h.onwriteend=function(){throw new Error('Write completed.')},h.onerror=function(j){throw new Error('Write failed: '+j.toString())};let i=new Blob([JSON.stringify(data)],{type:'application/json'});h.write(i)},b)},b)},b)}function readFile(){function b(f){throw new Error('Read error: '+f.code)}let c=window.TEMPORARY;window.requestFileSystem(c,5242880,function(f){f.root.getFile('cache.json',{},function(g){g.file(function(h){let i=new FileReader;i.onloadend=function(){data=JSON.parse(this.result)},i.readAsText(h)},b)},b)},b)}