'use strict';let data,input1=document.querySelector('#input1'),input2=document.querySelector('#input2'),input1Placeholder=document.querySelector('#input1-name'),input2Placeholder=document.querySelector('#input2-name'),selectFrom=document.querySelector('.select-from'),selectTo=document.querySelector('.select-to'),content=document.querySelector('.content'),spinner=document.querySelector('.spinner'),main=document.querySelector('.main'),error=document.querySelector('.error'),submit=document.querySelector('.submit'),choice1=new Choices('.select-from',{searchEnabled:!1}),choice2=new Choices('.select-to',{searchEnabled:!1});changePlaceholder1(),selectFrom.onchange=changePlaceholder1,changePlaceholder2(),selectTo.onchange=changePlaceholder2,submit.onclick=clickHandler,document.addEventListener('deviceready',onDeviceReady,!1);function onDeviceReady(){work()}function requestFunc(){return new Promise(function(a,b){let d=new XMLHttpRequest;d.open('GET','https://www.cbr-xml-daily.ru/daily_json.js'),d.onload=function(){200===d.status?a(d.response):b(Error('Error, status: '+d.statusText))},d.onerror=function(){b('Error, problem with Network')},d.send()})}async function getValutesOnline(){try{let a,b=await requestFunc();a=JSON.parse(b),a.Valute.RUB={Value:1},console.log(a),data=a,window.requestFileSystem(LocalFileSystem.PERSISTENT,0,gotFS,fail)}catch(a){showNetErr(a)}}function getValutesOffline(){window.resolveLocalFileSystemURL(cordova.file.applicationDirectory+'www/index.html',gotFile,fail)}function checkConnection(){return window.navigator.onLine}function showNetErr(a){console.error(a),swal({title:'Oops...',html:'Problem with your internet connection!<br>Sorry, our app need internet.',type:'error',showCloseButton:!0,showCancelButton:!0,allowOutsideClick:!1,confirmButtonText:'Retry',cancelButtonText:'Exit'}).then(function(){work()},function(b){'cancel'===b?navigator.app.exitApp():'close'==b&&work()})}function work(){spinner.classList.remove('off');try{checkConnection()?getValutesOnline():getValutesOffline(),main.classList.add('active'),content.classList.add('active')}catch(a){showNetErr(a)}spinner.classList.add('off')}function gotFS(a){a.root.getFile('cache.json',{create:!0,exclusive:!1},gotFileEntry,fail)}function gotFileEntry(a){a.createWriter(gotFileWriter,fail)}function gotFileWriter(a){a.onwriteend=function(){console.log('Data cashed')},a.write(JSON.stringify(data))}function gotFile(a){a.file(function(b){let c=new FileReader;c.onloadend=function(){console.log('Cashed data is: '+this.result),data=this.result},c.readAsText(b)})}function fail(a){throw new Error(a)}function clickHandler(){let a=selectFrom.value,b=selectTo.value,c=data.Valute[a],d=data.Valute[b],f=c.Value/d.Value/c.Nominal/d.Nominal,g=parseFloat(input1.value);isNaN(g)||(input2.parentElement.classList.add('is-dirty'),input2.value=g*f)}function changePlaceholder1(){input1Placeholder.innerHTML=selectFrom.value}function changePlaceholder2(){input2Placeholder.innerHTML=selectTo.value}